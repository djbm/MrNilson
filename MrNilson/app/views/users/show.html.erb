
<div class="modal fade" role="dialog" aria-labelledby="gridSystemModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Select an image</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class="row">

          	<%= form_tag({controller: "users", action: "set_user_image"}, method: "post", class: "update_image_form", id: "update_image_form", multipart: true, remote: true) do %>
	            <div class="col-md-4" style="padding-left: 0;">
		            <span class="btn btn-file" style="padding-left: 0;">
					    <%= file_field_tag 'picture', class: "picture", required: true %>
					    <!--<input id="picture" type="file" name="files[]" multiple
    data-url="/path/to/upload/handler.json"
    data-sequential-uploads="true"
    data-form-data='{"script": "true"}'>-->
					</span>
				</div>
          	
          </div>
          <div class="row" style="padding-top: 10px;">
          <div class="progress" style="border-radius: 50px; display: none;
">
		    <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%; text-align:center;">
		      <span></span>
		    </div>
		  </div>
	
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default cancel_image_attached" data-dismiss="modal">Close</button>
        <%= submit_tag 'Save Image', class: "btn btn-primary save_image_attached", disabled: true %>
      </div>
      <% end %><!-- end_form-->
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="panel panel-primary col">
  <div class="panel-heading">
    <h3 class="panel-title"><%= @current_user.firstname.to_s %></h3>
  </div>
  <div class="panel-body">
	<div class="row">
		<div class="card-container col-xs-2 col-md-1">
		  <div class="card">
		    <div class="side">
		    <%
               if (@current_user.present? && @current_user.image_info.present? && @current_user.image_info["secure_url"].present?)
                 url = @current_user.image_info["secure_url"].to_s 
               elsif (@current_user.meta.present? && @current_user.meta["genre"].present? && @current_user.meta["genre"] == "female") 
                  url = image_url("others/default_woman.png").to_s 
               else
                  url = image_url("others/default_man.png").to_s 
               end


              %>
				<%= cl_image_tag( url , :width => 150, :height => 150, 
             :crop => :thumb, :gravity => :face, :radius => :max, :class => "avatar_image") %>
		    <!--<img src="<%= image_path("others/d_javier.JPG")%>" class="img-circle avatar_image" alt="Circular Image">--></div>
		    <div class="side back avatar_image">
			<!--<button type="link" class="btn btn-primary" data-toggle="modal" data-target=".modal">Large modal</button>-->
		    <a href="" class="edit_photo_link">Edit Image</a></div>
		  </div>
		</div>
	<%#= cl_image_upload_tag(:image_id) %>
	  	<!--<div class="card col-xs-12 col-md-2">
	  		<img src="<%#= image_path("others/d_javier.JPG")%>" class="img-circle avatar_image" alt="Circular Image">
	  	</div>-->

	  	<!--<input id="fileupload" type="file" name="files[]" multiple
    data-url="/path/to/upload/handler.json"
    data-sequential-uploads="true"
    data-form-data='{"script": "true"}'>-->
    
  	<div class="col-md-1"></div>
	<div class="col-xs-12 col-md-6">
      <form accept-charset="UTF-8" action="http://simple-form-bootstrap.plataformatec.com.br/examples/create_basic" class="simple_form new_user_basic" enctype="multipart/form-data" id="new_user_basic" method="post" novalidate="novalidate"><div style="display:none"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="h/EsQ0nWUHyozlO5H2bQVjx5f6WnSuLgC2PqhWGWQxA=" /></div>
  

  <div class="form-group email required user_basic_email"><label class="email required control-label" for="user_basic_email"><abbr title="required">*</abbr> Email</label><input class="string email required form-control" id="user_basic_email" name="user_basic[email]" value="<%= @current_user.email %>" placeholder="Enter email" type="email" /><p class="help-block">Lorem ipsum dolor sit amet</p></div>

  <div class="form-group password required user_basic_password"><label class="password required control-label" for="user_basic_password"><abbr title="required">*</abbr> Password</label><input class="password required form-control" id="user_basic_password" name="user_basic[password]" placeholder="Password" type="password" /><p class="help-block">Lorem ipsum dolor sit amet</p></div>

  <div class="form-group file optional user_basic_file"><label class="file optional control-label" for="user_basic_file">File</label><input class="file optional" id="user_basic_file" name="user_basic[file]" type="file" /><p class="help-block">Example block-level help text here.</p></div>

  <div class="form-group boolean optional user_basic_active"><div class="checkbox"><input name="user_basic[active]" type="hidden" value="0" /><label class="boolean optional" for="user_basic_active"><input class="boolean optional" id="user_basic_active" name="user_basic[active]" type="checkbox" value="1" />Active</label></div><p class="help-block">Lorem ipsum dolor sit amet</p></div>

  <div class="form-group check_boxes optional user_basic_choices"><label class="check_boxes optional control-label">Choices</label><span class="checkbox"><label for="user_basic_choices_option_one_is_this_and_thatbe_sure_to_include_why_its_great"><input class="check_boxes optional" id="user_basic_choices_option_one_is_this_and_thatbe_sure_to_include_why_its_great" name="user_basic[choices][]" type="checkbox" value="Option one is this and that—be sure to include why it&#39;s great" />Option one is this and that—be sure to include why it&#39;s great</label></span><span class="checkbox"><label for="user_basic_choices_option_two_can_be_something_else_and_selecting_it_will_deselect_option_one"><input class="check_boxes optional" id="user_basic_choices_option_two_can_be_something_else_and_selecting_it_will_deselect_option_one" name="user_basic[choices][]" type="checkbox" value="Option two can be something else and selecting it will deselect option one" />Option two can be something else and selecting it will deselect option one</label></span><input name="user_basic[choices][]" type="hidden" value="" /></div>

  <div class="form-group radio_buttons optional user_basic_sex"><label class="radio_buttons optional control-label">Sex</label><span class="radio"><label for="user_basic_sex_male"><input class="radio_buttons optional" id="user_basic_sex_male" name="user_basic[sex]" type="radio" value="Male" />Male</label></span><span class="radio"><label for="user_basic_sex_female"><input class="radio_buttons optional" id="user_basic_sex_female" name="user_basic[sex]" type="radio" value="Female" />Female</label></span><p class="help-block">Lorem ipsum dolor sit amet</p></div>

  <input class="btn btn-default" name="commit" type="submit" value="Create User" />
</form>
    </div>
  </div>
</div>
</div>

<script type="text/javascript">
	jQuery(document).ready(function(){
		jQuery("body").on('click', '.edit_photo_link', function(ev){
			ev.preventDefault();
			jQuery('.modal').modal('show');		
			jQuery('.progress-bar').css('width','0%');	
			jQuery('.progress-bar').find("span").text("");
			jQuery("input:file").val('');
			jQuery('.progress-bar').addClass("active");
			jQuery('.progress-bar').addClass("progress-bar-striped");
			jQuery('.progress-bar').removeClass("progress-bar-success");
	    	jQuery('.progress-bar').removeClass("progress-bar-danger");
	    	jQuery('.save_image_attached').prop("disabled",true);	
	    	jQuery('.progress').hide();
		});

		/*jQuery('.cloudinary-fileupload').bind('cloudinarydone', function(e, data) {  
		  jQuery('.preview').html(
		    jQuery.cloudinary.image(data.result.public_id, 
		      { format: data.result.format, version: data.result.version, 
		        crop: 'fill', width: 150, height: 100 })
		  );    
		  jQuery('.image_public_id').val(data.result.public_id);    
		  return true;
		});*/

		jQuery('body').on('click', 'input.picture:input[type=file]', function(){
			jQuery('.progress-bar').addClass("progress-bar-striped");
			jQuery('.progress-bar').addClass("active");
			jQuery('.progress-bar').removeClass("progress-bar-success");
	    	jQuery('.progress-bar').removeClass("progress-bar-danger");	
	    	//jQuery('.save_image_attached').prop("disabled",true);
			jQuery('.progress-bar').css('width','0%');	
			jQuery('.progress-bar').find("span").text("");
			jQuery('.progress').hide();	
		});

		jQuery("input:file").change(function (){
			if(jQuery(this).val() == ''){
		       jQuery('.save_image_attached').prop("disabled",true);
		   }else{
		   		jQuery('.save_image_attached').prop("disabled",false);
		   }
	     });

		jQuery("#update_image_form").ajaxForm({
				data: {
					"user_id": <%= params[:id] %>
				},
				beforeSubmit: function(){
					console.log('antes de send');
					jQuery('.progress-bar').addClass("progress-bar-striped");
					jQuery('.progress-bar').addClass("active");
					jQuery('.progress-bar').removeClass("progress-bar-success");	
			    	jQuery('.progress-bar').removeClass("progress-bar-danger");
			    	jQuery('.progress').show();
			    	jQuery('.save_image_attached').prop("disabled",true);
				},
	    		uploadProgress: function(e,position, total, percent){
	    				    
			        jQuery('.progress-bar').css(
			            'width',
			            percent + '%'
			        );
			        
			        //jQuery('.progress-bar').find("span").text(percent+"%");
	    		},
				success: function (responseText){
					var new_url = responseText["secure_url"];
			    	jQuery('.progress-bar').addClass("progress-bar-success");
			    	jQuery('.progress-bar').removeClass("progress-bar-striped");
			    	jQuery('.progress-bar').removeClass("progress-bar-danger");
			    	jQuery('.progress-bar').removeClass("active");
		    		jQuery('.progress-bar').find("span").text("Uploading Completed");
		    		jQuery('.avatar_image').prop( "src", new_url );
		    		jQuery('.gravatar_image').prop( "src", new_url );
		    		
			    },
			    error: function (e, data){

			    	jQuery('.progress-bar').addClass("progress-bar-danger");
			    	jQuery('.progress-bar').removeClass("progress-bar-success");
			    	jQuery('.progress-bar').removeClass("progress-bar-striped");
			    	jQuery('.progress-bar').removeClass("active");
			    	jQuery('.progress-bar').find("span").text("Uploading Error");
			    },
			    complete: function(e, data){
			    	jQuery('.save_image_attached').prop("disabled",true);
			    }
		});
	});
</script>